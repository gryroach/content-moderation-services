# Графана для мониторинга логов в Graduate Work

Этот документ описывает использование Grafana для мониторинга логов в проекте Graduate Work.

## О системе мониторинга

Для сбора и анализа логов используется связка:

- **Loki** - система хранения и индексации логов
- **Grafana** - платформа визуализации и аналитики
- **Promtail** - агент для сбора логов и отправки их в Loki

## Запуск системы мониторинга

Вся система мониторинга запускается с помощью Docker Compose из корневой директории проекта:

```bash
docker-compose -f docker-compose.logs.yml up -d
```

После запуска контейнеров, дашборд будет доступен по прямой ссылке:
**[http://localhost:3000/d/graduate-work-logs/graduate-work-logs?orgId=1&amp;refresh=10s](http://localhost:3000/d/graduate-work-logs/graduate-work-logs?orgId=1&refresh=10s)**

Учетные данные по умолчанию:

- **Логин**: admin
- **Пароль**: admin

## Дашборд логов

Дашборд логов в Grafana предоставляет комплексный обзор всех логов системы:

### Верхняя секция - Логи и поиск

В верхней части дашборда расположены три панели:

- **Логи всех выбранных контейнеров** - отображает все логи из выбранных контейнеров
- **Поиск по уровню логов** - фильтрует логи по уровню (ERROR, WARNING, INFO, DEBUG)
- **Поиск по тексту** - позволяет искать произвольный текст в логах

### Средняя секция - Графики и статистика

- **Количество сообщений по типам логов** - линейный график, показывающий количество сообщений разных уровней логирования в реальном времени
- **HTTP методы NGINX** - круговая диаграмма, отображающая распределение HTTP методов (GET, POST, PUT и т.д.)
- **HTTP статусы NGINX** - круговая диаграмма со статусами ответов HTTP (200, 404, 500 и т.д.)
- **Популярные комбинации метод/статус NGINX** - круговая диаграмма, показывающая комбинации методов и статусов (GET 200, GET 404 и т.д.)

### Нижняя секция - Логи по контейнерам

Автоматически создаваемые панели для каждого выбранного контейнера, показывающие их логи отдельно.

## Доступные переменные

Дашборд поддерживает следующие настраиваемые переменные:

- **Контейнер** - выбор одного или нескольких контейнеров для отображения логов
- **Тип лога** - фильтрация по типу логов (ERROR, WARNING, INFO, DEBUG)
- **Текст для поиска** - поиск произвольного текста в логах

## Работа с дашбордом

### Как фильтровать логи:

1. Выберите интересующий вас контейнер из выпадающего списка
2. Для поиска ошибок выберите "ERROR" в переменной "Тип лога"
3. Для поиска произвольного текста введите его в поле "Текст для поиска"

### Как анализировать графики:

- **Линейный график** показывает скачки различных типов логов. Обратите внимание на резкие увеличения количества ERROR или WARNING
- **Круговые диаграммы** помогают определить распределение HTTP запросов и статусов ответов

### Как использовать временной диапазон:

По умолчанию отображаются данные за последние 15 минут. Чтобы изменить этот диапазон:

1. Нажмите на текущий временной диапазон в правом верхнем углу
2. Выберите предустановленное значение или задайте произвольный диапазон

## Настройка уведомлений

Вы можете настроить уведомления при превышении определенного количества ошибок:

1. Перейдите в раздел "Alerting" в Grafana
2. Создайте новое правило, основанное на количестве ERROR логов
3. Настройте каналы уведомлений (email, Slack, и т.д.)

## Устранение неполадок

Если дашборд не отображает логи:

1. Убедитесь, что все контейнеры запущены: `docker-compose -f docker-compose.logs.yml ps`
2. Проверьте логи контейнеров: `docker-compose -f docker-compose.logs.yml logs loki grafana promtail`
3. Убедитесь, что Loki доступен из Grafana: `curl http://localhost:3100/ready`
